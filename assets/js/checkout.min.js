jQuery(function(a){var b={$checkout_form:a("form.checkout"),$order_review:a("form#order_review"),ppp:null,form_confirmed:!1,init:function(){a(document.body).on("update_checkout",this.update_checkout),a(document.body).on("updated_checkout",this.updated_checkout),a("form.checkout").on("submit","#place_order",this.form_checkout_submit),this.window_event_listener(),this.$checkout_form.on("submit",this.place_order),this.$checkout_form.on("change","#billing_persontype",this.trigger_update_checkout),this.$checkout_form.on("change","#billing_first_name, #billing_last_name, #billing_cpf, #billing_cnpj, #billing_email, #billing_address, #billing_number, #billing_address2, #billing_neighborhood, #billing_city, #billing_state, #billing_country",this.trigger_update_checkout),this.$checkout_form.on("change","#shipping_first_name, #shipping_last_name, #shipping_address, #shipping_number, #shipping_address2, #shipping_neighborhood, #shipping_city, #shipping_state, #shipping_country",this.trigger_update_checkout),this.$checkout_form.on("click","#place_order",this.openCheckout),this.$order_review.on("submit",this.openCheckout),""!==wc_ppb_params.order_id&&a(document.body).trigger("updated_checkout")},update_checkout:function(){b.ppp=null},updated_checkout:function(){b.form_confirmed=!1;var c=a("#paypal-plus-brazil-info"),d=a("#paypal-plus-brazil-approval-url").val();if(c.length){var e=JSON.parse(c.val());b.overlay_css(),b.ppp=PAYPAL.apps.PPP({approvalUrl:d,placeholder:"ppplus",mode:wc_ppb_params.mode,payerFirstName:e.billing_first_name,payerLastName:e.billing_last_name,payerEmail:e.billing_email,payerTaxId:e.billing_person_id,payerTaxIdType:e.billing_person_type,language:"pt_BR",country:"BR",iframeHeight:"400",buttonLocation:"inside",disallowRememberedCards:!1,rememberedCards:wc_ppb_params.remembered_cards})}},window_event_listener:function(){if(window.addEventListener)window.addEventListener("message",b.message_listener,!1);else{if(!window.attachEvent)throw new Error("Can't attach message listener");window.attachEvent("onmessage",b.message_listener)}},message_listener:function(c){try{var d=JSON.parse(c.data);if("resizeHeightOfTheIframe"===d.action);else if("loaded"===d.action)b.disable_overlay_css();else if("enableContinueButton"===d.action){var e=a("#place_order");b.is_paypal_selected()&&e.prop("disabled",!1),"error"===d.result&&b.resize_ppplus(),e.prop("disabled",!1)}else if("disableContinueButton"===d.action){var e=a("#place_order");e.prop("disabled",!0)}else if("checkout"===d.action){var f=d.result.payment_approved;if(f===!0){var g=d.result.rememberedCards,h=d.result.payer.payer_info.payer_id,i=a("#paypal-plus-brazil-rememberedcards"),j=a("#paypal-plus-brazil-payerid");i.val(g),j.val(h)}b.finish_submit_form()}else"onError"===d.action&&(b.resize_ppplus(),'"NO_VALID_FUNDING_SOURCE_OR_RISK_REFUSED"'===d.cause||'"RISK_N_DECLINE"'===d.cause||'"TRY_ANOTHER_CARD"'===d.cause||'"NO_VALID_FUNDING_INSTRUMENT"'===d.cause?b.finish_submit_form():'"PPPLUS_NOT_AVAILABLE_FOR_MERCHANT"'===d.cause?b.add_error_message(wc_ppb_params.paypal_plus_not_available):'"CHECK_ENTRY"'===d.cause?b.add_error_message(wc_ppb_params.check_entry):'"SOCKET_HANG_UP"'===d.cause||'"UNKNOWN_INTERNAL_ERROR"'===d.cause||'"INTERNAL_SERVICE_ERROR"'===d.cause||'"INTERNAL_SERVER_ERROR"'===d.cause?(b.trigger_update_checkout(),b.force_reload_iframe()):b.add_error_message(wc_ppb_params.unknown_error))}catch(k){b.add_error_message(wc_ppb_params.unknown_error_json)}},add_error_message:function(b){var c=a(".payment_box.payment_method_paypal-plus-brazil"),d='<div class="woocommerce-error woocommerce-error-paypal-plus-brazil">'+b+"</div>";c.prepend(d)},clear_error_messages:function(){a(".woocommerce-error-paypal-plus-brazil").remove()},finish_submit_form:function(){b.form_confirmed=!0,""!==wc_ppb_params.order_id?b.$order_review.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}).submit():b.$checkout_form.submit()},force_reload_iframe:function(){},resize_ppplus:function(){a("#ppplus, #ppplus iframe").css("height","440px").css("min-height","440px").css("max-height","440px")},is_paypal_selected:function(){return a("#payment_method_paypal-plus-brazil").is(":checked")},form_checkout_submit:function(){return!1},trigger_update_checkout:function(){a(document.body).trigger("update_checkout")},overlay_css:function(){a("#paypal-plus-brazil-payment-form").block({message:wc_ppb_params.paypal_loading_message,overlayCSS:{background:wc_ppb_params.paypal_loading_bg_color,opacity:wc_ppb_params.paypal_loading_bg_opacity}})},disable_overlay_css:function(){a("#paypal-plus-brazil-payment-form").unblock()},openCheckout:function(){if(b.clear_error_messages(),!b.form_confirmed&&b.is_paypal_selected()){a("form.checkout, form#order_review");return b.ppp.doContinue(),!1}}};b.init()});